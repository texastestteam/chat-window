<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chat Window with Embedded Data</title>
  <!-- Include the p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
</head>
<body>
  <!-- This script contains our p5.js code -->
  <script>
    let screenNames = [
      "Chill Dog",
      "Lazy Dog",
      "Internet Dog",
      "Happy Dog",
      "Sleepy Dog",
      "Silly Cat",
      "Grumpy Cat",
      "Whiskers",
      "Purrfect Cat",
      "Curious Cat"
    ];

    let topicSayings = {
      "Pets": [
        "Woof woof!",
        "Meow meow!",
        "Just chilling...",
        "Nap time!",
        "Anyone up for a walk?",
        "Found a comfy spot!",
        "Chasing lasers!",
        "Looking for treats!",
        "Time to play!",
        "Purring loudly!"
      ],
      "Gaming": [
        "GG!",
        "Victory Royale!",
        "Anyone up for Fortnite?",
        "I love Fortnite!",
        "Just got number 2!",
        "Let's squad up!",
        "Building ramps!",
        "Watch out for snipers!",
        "Battle bus is leaving!",
        "Drop at Tilted Towers?"
      ],
      "Art": [
        "The juxtaposition of colors is fascinating.",
        "This piece evokes deep emotions.",
        "The brushwork is impeccable.",
        "Analyzing fine art design.",
        "The composition is well-balanced.",
        "Exploring abstract forms.",
        "The chiaroscuro adds depth.",
        "Admiring the texture.",
        "The use of space is intriguing.",
        "Art is a universal language."
      ],
      "Philosophy": [
        "The unexamined life is not worth living.",
        "Knowledge begins in wonder.",
        "Man is by nature a political animal.",
        "Happiness depends upon ourselves.",
        "I know that I know nothing.",
        "The only true wisdom is in knowing you know nothing.",
        "Virtue is knowledge.",
        "We are what we repeatedly do.",
        "To perceive is to suffer.",
        "Pleasure in the job puts perfection in the work."
      ],
      "Coding": [
        "Wow, nice!",
        "Is this the matrix?",
        "Hello World!",
        "Just debugging...",
        "Found a bug!",
        "Compiling code...",
        "Syntax error unexpected token",
        "Code is poetry",
        "I love programming!",
        "Stack overflowed!"
      ],
      "Weather": [
        "What's the weather?",
        "It's nice and sunny here.",
        "Internet weather here.",
        "78 in Washington.",
        "Expecting rain later.",
        "Perfect day for a walk.",
        "Stormy skies ahead.",
        "Feeling the heat today.",
        "Cold fronts moving in.",
        "Checking the forecast."
      ]
    };

    let topicFrequencies = {
      "Pets": [10, 10, 15, 15, 5, 10, 5, 10, 15, 5],
      "Gaming": [15, 10, 15, 10, 10, 5, 5, 5, 5, 10],
      "Art": [10, 10, 15, 15, 10, 5, 5, 10, 5, 5],
      "Philosophy": [10, 10, 10, 10, 10, 10, 10, 10, 10, 10],
      "Coding": [10, 10, 15, 15, 10, 10, 5, 5, 10, 10],
      "Weather": [10, 15, 5, 10, 8, 12, 6, 9, 7, 8]
    };

    let winSayings = [
      "GG",
      "Victory",
      "Wow",
      "🌠🌠🌠",
      "⋆͛*͛ ͙͛⁑͛⋆͛*͛ ͙͛ ଘ(੭*ˊᵕˋ)੭*"
    ];

    let messages = []; // Array to hold chat messages
    let maxMessages = 50; // Maximum messages to display
    let lastMessageTime = 0;
    let messageInterval = 2000; // Default interval in milliseconds

    let speedSlider; // Slider to control chat speed
    let textSizeSlider; // Slider to control text size
    let nameColors = {}; // Object to store unique colors for each screen name

    let petCheckbox, gamingCheckbox, artCheckbox, philosophyCheckbox, codingCheckbox, weatherCheckbox;

    let winButton;
    let winMode = false;
    let winModeStartTime = 0;

    // Button dimensions
    let buttonWidth;
    let buttonHeight = 30;
    let buttonY;

    function setup() {
      createCanvas(600, 600);
      textSize(14);
      textFont('Arial');

      // Assign a unique random color to each screen name
      screenNames.forEach(name => {
        nameColors[name] = color(random(100, 255), random(100, 255), random(100, 255));
      });

      // Create the text size slider (from 10 to 24, default at 14)
      textSizeSlider = createSlider(10, 24, 14, 1);
      textSizeSlider.position(10, height - 170);
      textSizeSlider.style('width', '580px');

      // Create the speed slider (from 1 to 5, default at 3)
      speedSlider = createSlider(1, 5, 3, 0.1);
      speedSlider.position(10, height - 140);
      speedSlider.style('width', '580px');

      // Create checkboxes for topics
      petCheckbox = createCheckbox('Pets', true);
      petCheckbox.position(10, height - 120);
      gamingCheckbox = createCheckbox('Gaming', false);
      gamingCheckbox.position(80, height - 120);
      artCheckbox = createCheckbox('Art', false);
      artCheckbox.position(160, height - 120);
      philosophyCheckbox = createCheckbox('Philosophy', false);
      philosophyCheckbox.position(230, height - 120);
      codingCheckbox = createCheckbox('Coding', false);
      codingCheckbox.position(340, height - 120);
      weatherCheckbox = createCheckbox('Weather', false); // New Weather checkbox
      weatherCheckbox.position(420, height - 120);

      // Calculate button dimensions
      buttonWidth = (width - 20) / 4; // Divide the controls area width by 4
      buttonY = height - 90; // Position of the buttons

      // Create the Win button
      winButton = createButton('Win');
      winButton.position(10, buttonY);
      winButton.size(buttonWidth, buttonHeight);
      winButton.mousePressed(activateWinMode);
    }

    function draw() {
      background(30); // Dark mode background

      // Get the current speed from the slider
      let speed = speedSlider.value();

      // Calculate message interval based on whether Win mode is active
      if (winMode) {
        // During Win mode, messages appear twice as fast
        messageInterval = map(speed, 1, 5, 5000, 1000) / 2;
      } else {
        messageInterval = map(speed, 1, 5, 5000, 1000);
      }

      // Get text size from slider
      let txtSize = textSizeSlider.value();
      textSize(txtSize);

      // Add a new message if the interval has passed
      if (millis() - lastMessageTime > messageInterval) {
        addNewMessage();
        lastMessageTime = millis();
      }

      // Draw the chat window and messages
      drawChatWindow();

      // Draw the Win mode indicator over the Win button
      drawWinIndicator();
    }

    function activateWinMode() {
      winMode = true;
      winModeStartTime = millis();
    }

    function addNewMessage() {
      // Randomly select a screen name
      let name = random(screenNames);

      let saying;

      if (winMode) {
        // During Win mode, use winSayings
        saying = random(winSayings);

        // Check if 10 seconds have passed
        if (millis() - winModeStartTime > 10000) {
          winMode = false;
        }
      } else {
        // Get a saying based on selected topics
        saying = getRandomSaying();

        // If no topics are selected, do nothing
        if (!saying) return;
      }

      // Add the new message to the messages array
      messages.push({ name: name, text: saying });

      // Keep the messages array within the maximum limit
      if (messages.length > maxMessages) {
        messages.shift();
      }
    }

    function getRandomSaying() {
      let availableSayings = [];
      let availableFrequencies = [];

      // Collect sayings and frequencies based on selected topics
      if (petCheckbox.checked() && topicSayings['Pets']) {
        availableSayings = availableSayings.concat(topicSayings['Pets']);
        availableFrequencies = availableFrequencies.concat(topicFrequencies['Pets']);
      }
      if (gamingCheckbox.checked() && topicSayings['Gaming']) {
        availableSayings = availableSayings.concat(topicSayings['Gaming']);
        availableFrequencies = availableFrequencies.concat(topicFrequencies['Gaming']);
      }
      if (artCheckbox.checked() && topicSayings['Art']) {
        availableSayings = availableSayings.concat(topicSayings['Art']);
        availableFrequencies = availableFrequencies.concat(topicFrequencies['Art']);
      }
      if (philosophyCheckbox.checked() && topicSayings['Philosophy']) {
        availableSayings = availableSayings.concat(topicSayings['Philosophy']);
        availableFrequencies = availableFrequencies.concat(topicFrequencies['Philosophy']);
      }
      if (codingCheckbox.checked() && topicSayings['Coding']) {
        availableSayings = availableSayings.concat(topicSayings['Coding']);
        availableFrequencies = availableFrequencies.concat(topicFrequencies['Coding']);
      }
      if (weatherCheckbox.checked() && topicSayings['Weather']) { // New Weather topic
        availableSayings = availableSayings.concat(topicSayings['Weather']);
        availableFrequencies = availableFrequencies.concat(topicFrequencies['Weather']);
      }

      // If no topics are selected, return null
      if (availableSayings.length === 0) {
        return null;
      }

      // Calculate total frequency
      let totalFrequency = availableFrequencies.reduce((a, b) => a + b, 0);
      let rnd = random(totalFrequency);
      let accum = 0;
      // Select a saying based on its frequency
      for (let i = 0; i < availableSayings.length; i++) {
        accum += availableFrequencies[i];
        if (rnd < accum) {
          return availableSayings[i];
        }
      }
      // Fallback in case of error
      return random(availableSayings);
    }

    function drawChatWindow() {
      // Draw the chat window background
      fill(50);
      rect(10, 10, width - 20, height - 200);

      // Begin drawing messages
      push();
      translate(15, height - 200); // Adjusted position to prevent overlap
      let y = 0;
      let lineHeight = textSizeSlider.value() + 6; // Adjust line height based on text size
      // Loop through messages in reverse to display the latest ones at the bottom
      for (let i = messages.length - 1; i >= 0; i--) {
        let msg = messages[i];
        fill(nameColors[msg.name]); // Set text color to the screen name's color
        text(msg.name + ": ", 0, -y);
        fill(200); // Light text color for the message text
        text(msg.text, textWidth(msg.name + ": "), -y);
        y += lineHeight; // Move up for the next message
        if (y > height - 220) {
          break; // Stop if we've filled the chat window
        }
      }
      pop();
    }

    function drawWinIndicator() {
      // Draw the blue bar indicator over the Win button if winMode is active
      if (winMode) {
        let elapsedTime = millis() - winModeStartTime;
        let remainingTime = 10000 - elapsedTime;
        let barWidth = map(remainingTime, 0, 10000, 0, buttonWidth);
        fill(0, 0, 255, 100); // Semi-transparent blue
        noStroke();
        rect(10, buttonY, barWidth, buttonHeight);

        // Reset winMode after 10 seconds
        if (remainingTime <= 0) {
          winMode = false;
        }
      }
    }
  </script>
</body>
</html>
